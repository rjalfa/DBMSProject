create database MedSH;
use MedSH;
create table Department(dept_id bigint PRIMARY KEY AUTO_INCREMENT, dept_name varchar(100) NOT NULL);
create table Employee(uid bigint PRIMARY KEY AUTO_INCREMENT, name varchar(100) NOT NULL, dob Date NOT NULL, gender varchar(100) NOT NULL, contact varchar(100) NOT NULL, doj Date NOT NULL, payroll bigint NOT NULL, username varchar(100) NOT NULL, password varchar(100) NOT NULL, type varchar(20) NOT NULL CHECK (type IN ('Doctor','Nurse','Staff')) , isAdmin boolean NOT NULL);
create table Patient(pid bigint PRIMARY KEY AUTO_INCREMENT, dob Date NOT NULL, name varchar(100) NOT NULL);	
create table Schedule(s_id bigint PRIMARY KEY AUTO_INCREMENT, doctor_id bigint NOT NULL, INDEX doctor_index (doctor_id), FOREIGN KEY (doctor_id) references Employee(uid) ON DELETE CASCADE);
create table Task(task_id bigint PRIMARY KEY AUTO_INCREMENT, s_id bigint NOT NULL, pid bigint NOT NULL, date_time Datetime NOT NULL, task_type varchar(100) NOT NULL, INDEX patient_index (pid), INDEX sched_index (s_id), FOREIGN KEY (pid) references Patient(pid) ON DELETE CASCADE, FOREIGN KEY (s_id) references Schedule(s_id) ON DELETE CASCADE);
create table Nurse(uid bigint NOT NULL, INDEX nurse_index (uid),FOREIGN KEY (uid) references Employee(uid) ON DELETE CASCADE);
create table Doctor(uid bigint NOT NULL, dept_id bigint NOT NULL, INDEX doctor_index (uid), INDEX dept_index (dept_id),FOREIGN KEY (uid) references Employee(uid), FOREIGN KEY (dept_id) references Department(dept_id));
create table Nurse_Task(uid bigint NOT NULL, task_id bigint NOt NULL, INDEX nurse_index (uid), INDEX task_index (task_id), FOREIGN KEY (uid) references Employee(uid) ON DELETE CASCADE, FOREIGN KEY (task_id) references Task(task_id) ON DELETE CASCADE);
create table Room(room_no bigint NOT NULL, floor bigint NOT NULL, building bigint NOT NULL, room_type varchar(100) NOT NULL, task_id bigint NOT NULL, INDEX task_index (task_id), FOREIGN KEY (task_id) references Task(task_id) ON DELETE CASCADE, PRIMARY KEY (room_no, floor, building));
create table Staff(uid bigint NOT NULL, isAdmin boolean, job_title varchar(100), INDEX staff_index (uid), FOREIGN KEY (uid) references Employee(uid) ON DELETE CASCADE);
create table LogRecord(task_id bigint NOT NULL, uid bigint NOT NULL, date_in Date NOT NULL, date_out Date, log_id bigint PRIMARY KEY AUTO_INCREMENT, appt_type varchar(100) NOT NULL, payment bigint NOT NULL, isPaid boolean, INDEX task_index (task_id), INDEX staff_index (uid), FOREIGN KEY (task_id) references Task(task_id) ON DELETE CASCADE, FOREIGN KEY (uid) references Employee(uid) ON DELETE CASCADE);